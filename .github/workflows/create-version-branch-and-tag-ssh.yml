name: æ›´æ–°åˆ†æ”¯å¹¶æ‰“Tagï¼šå­æ¨¡å— + å¤šæ–‡ä»¶æ›¿æ¢ + Tagé”šå®šåˆ†æ”¯HEAD

on:
  workflow_dispatch:
    inputs:
      work_branch:
        description: "è¦æ›´æ–°å¹¶æ‰“Tagçš„åˆ†æ”¯ï¼ˆä¾‹å¦‚ 1.4.2ï¼‰"
        required: true
        default: "1.4.2"
      # 1. URLæ›¿æ¢ç›¸å…³é…ç½®
      admin_url:  
        description: "å°†ä»“åº“å†…æ‰€æœ‰ https://admin.rustdesk.com æ›¿æ¢ä¸ºè¯¥åœ°å€ï¼ˆä¸æ”¹å­æ¨¡å—å†…å®¹ï¼‰"  
        required: true  
        default: "https://admin-hy.rs.ldxw.top"  
      # 2. å­æ¨¡å—ç›¸å…³é…ç½®
      submodule_url:  
        description: "libs/hbb_common å­æ¨¡å—å…¬å¼€ä»“åº“ï¼ˆHTTPSï¼‰åœ°å€"  
        required: true  
        default: "https://github.com/ldxw/rustdesk_hbb_common.git"  
      submodule_branch:  
        description: "libs/hbb_common å­æ¨¡å—åˆ†æ”¯ï¼ˆauto=è‡ªåŠ¨æ£€æµ‹è¿œç«¯é»˜è®¤åˆ†æ”¯ï¼‰"  
        required: true  
        default: "auto"  
      # 3. å¤šæ–‡ä»¶æ›¿æ¢ï¼šè·³è¿‡/å¼ºåˆ¶ä¿®æ”¹é…ç½®ï¼ˆæ ¸å¿ƒæ–°å¢ï¼‰
      url_replace_strategy:
        description: "admin URLæ›¿æ¢ç­–ç•¥ï¼ˆæ£€æµ‹æ— éœ€ä¿®æ”¹æ—¶çš„å¤„ç†ï¼‰"
        type: choice
        options: ["skip", "force"]
        required: true
        default: "skip"
        description: "skip=æ£€æµ‹æ— éœ€ä¿®æ”¹åˆ™è·³è¿‡ï¼›force=å¼ºåˆ¶æ‰§è¡Œæ›¿æ¢ï¼ˆè¦†ç›–ç°æœ‰å†…å®¹ï¼‰"
      dart_replace_strategy:
        description: "connection_page.dartæ›¿æ¢ç­–ç•¥ï¼ˆæ£€æµ‹æ— éœ€ä¿®æ”¹æ—¶çš„å¤„ç†ï¼‰"
        type: choice
        options: ["skip", "force"]
        required: true
        default: "skip"
        description: "skip=æ£€æµ‹æ— éœ€ä¿®æ”¹åˆ™è·³è¿‡ï¼›force=å¼ºåˆ¶æ‰§è¡Œæ›¿æ¢ï¼ˆè¦†ç›–ç°æœ‰å†…å®¹ï¼‰"
      # 4. æ¨åˆ†æ”¯ä¸æ‰“Tagé…ç½®
      push_branch:  
        description: "æ˜¯å¦æ¨é€åˆ†æ”¯ï¼ˆtrue=æ¨ï¼›false=åªæœ¬åœ°æ›´æ”¹ï¼‰"  
        type: choice  
        options: ["true", "false"]  
        required: true  
        default: "true"  
      force:  
        description: "æ¨åˆ†æ”¯/å»ºTagæ˜¯å¦å¼ºåˆ¶ï¼ˆåˆ†æ”¯--force-with-leaseï¼›Tag -fï¼‰"  
        type: choice  
        options: ["false", "true"]  
        required: true  
        default: "false"  
      do_tag:  
        description: "æ˜¯å¦åœ¨åˆ†æ”¯HEADæ‰“Tag"  
        type: choice  
        options: ["true", "false"]  
        required: true  
        default: "true"  
      version:  
        description: "Tag åï¼ˆç•™ç©ºä½¿ç”¨ work_branchï¼‰"  
        required: false  
        default: ""  
      tag_message:  
        description: "Tag æ³¨é‡Š"  
        required: false  
        default: "ä¿®æ”¹å†…ç½®æœåŠ¡å™¨å’Œ key + åˆ é™¤å®¢æˆ·ç«¯å¹¿å‘Šæç¤º"  
      retag:  
        description: "æ˜¯å¦å¼ºåˆ¶é‡æ‰“Tagï¼ˆå…ˆåˆ è¿œç«¯åŒåTagå†å»ºï¼‰"  
        type: choice  
        options: ["true", "false"]  
        required: true  
        default: "true"

permissions:
  contents: write  # æˆäºˆå®Œæ•´å†…å®¹å†™å…¥æƒé™ï¼Œè¦†ç›–å­æ¨¡å—ã€æ›¿æ¢ã€æ¨é€ã€æ‰“Tagåœºæ™¯

jobs:
  update_and_tag:
    runs-on: ubuntu-latest
    env:
      WORK_BRANCH: ${{ inputs.work_branch }}
      SM_PATH: "libs/hbb_common"  # å­æ¨¡å—è·¯å¾„ç»Ÿä¸€ç®¡ç†
      TARGET_OLD_URL: "https://admin.rustdesk.com"  # å¾…æ›¿æ¢æ—§URLç»Ÿä¸€ç®¡ç†
      # å¤šæ›¿æ¢æ–‡ä»¶è·¯å¾„ç»Ÿä¸€ç®¡ç†ï¼ˆä¾¿äºåç»­ç»´æŠ¤ï¼‰
      URL_REPLACE_EXCLUDE: ":!:${SM_PATH}"  # URLæ›¿æ¢æ’é™¤ç›®å½•
      DART_TARGET_FILE: "flutter/lib/desktop/pages/connection_page.dart"  # Dartç›®æ ‡æ–‡ä»¶
      DART_START_LINE: 81  # Dartæ–‡ä»¶ä¿®æ”¹èµ·å§‹è¡Œ
      DART_END_LINE: 110   # Dartæ–‡ä»¶ä¿®æ”¹ç»“æŸè¡Œ
    steps:
      # æ­¥éª¤1ï¼šæ‹‰å–ä»“åº“ï¼ˆå®Œæ•´å†å²+å…³é—­é»˜è®¤å‡­è¯ï¼Œé¿å…åç»­æƒé™å†²çªï¼‰
      - name: Checkout repo (full history + no persisted creds)
        uses: actions/checkout@v4
        with:
          fetch-depth: 0
          persist-credentials: false
          submodules: false  # å­æ¨¡å—å•ç‹¬å¤„ç†ï¼Œé¿å…æå‰æ‹‰å–å¯¼è‡´é…ç½®å¤±æ•ˆ

      # æ­¥éª¤2ï¼šé…ç½®Gitèº«ä»½ï¼ˆä¸¥æ ¼æ ¡éªŒï¼Œé¿å…æäº¤èº«ä»½å¼‚å¸¸ï¼‰
      - name: Configure Git identity
        run: |
          set -euo pipefail
          echo -e "\n=================================================="
          echo -e "ğŸ”§ é…ç½®Gitæäº¤èº«ä»½ï¼ˆç¬¦åˆGitHub Actionsè§„èŒƒï¼‰"
          echo -e "==================================================\n"
          
          git config --global user.name "github-actions[bot]"
          git config --global user.email "41898282+github-actions[bot]@users.noreply.github.com"
          
          # æ ¡éªŒé…ç½®ç»“æœï¼Œå¤±è´¥åˆ™ç»ˆæ­¢æµç¨‹
          if [ "$(git config --global user.name)" != "github-actions[bot]" ] || [ "$(git config --global user.email)" != "41898282+github-actions[bot]@users.noreply.github.com" ]; then
            echo -e "\n::error::âŒ Gitèº«ä»½é…ç½®å¤±è´¥ï¼Œå½“å‰name=$(git config --global user.name:-ç©º)ï¼Œemail=$(git config --global user.email:-ç©º)"
            exit 1
          fi
          echo "âœ… Gitèº«ä»½é…ç½®æˆåŠŸï¼šname=github-actions[bot]ï¼Œemail=41898282+github-actions[bot]@users.noreply.github.com"

      # æ­¥éª¤3ï¼šæœ¬åœ°å‡†å¤‡ç›®æ ‡åˆ†æ”¯ï¼ˆåŒé‡æ ¡éªŒ+å†²çªé¢„è­¦ï¼Œé¿å…åˆ†æ”¯å¼‚å¸¸ï¼‰
      - name: Prepare target branch locally
        run: |
          set -euo pipefail
          echo -e "\n=================================================="
          echo -e "ğŸ“¦ æœ¬åœ°åˆå§‹åŒ–ç›®æ ‡åˆ†æ”¯ï¼š${WORK_BRANCH}"
          echo -e "ğŸ“Œ æµç¨‹ï¼šæ‹‰å–è¿œç«¯ â†’ æ ¡éªŒå­˜åœ¨æ€§ â†’ åˆ‡æ¢/åˆ›å»º â†’ åŒæ­¥æ›´æ–°"
          echo -e "==================================================\n"
          
          # æ‹‰å–è¿œç«¯åˆ†æ”¯ï¼ˆä¸å«Tagï¼Œé¿å…å†—ä½™ï¼‰
          echo "ğŸ” æ‹‰å–è¿œç«¯æœ€æ–°åˆ†æ”¯ä¿¡æ¯..."
          git fetch origin --no-tags || { echo -e "\n::error::âŒ æ‹‰å–è¿œç«¯åˆ†æ”¯å¤±è´¥ï¼Œæ£€æŸ¥ä»“åº“è¿æ¥/æƒé™"; exit 1; }
          echo "âœ… è¿œç«¯åˆ†æ”¯ä¿¡æ¯æ‹‰å–å®Œæˆ"

          # æ ¡éªŒè¿œç«¯åˆ†æ”¯æ˜¯å¦å­˜åœ¨
          if ! git show-ref --verify --quiet "refs/remotes/origin/${WORK_BRANCH}"; then
            echo -e "\n::error::âŒ è¿œç«¯æ— åˆ†æ”¯ã€Œorigin/${WORK_BRANCH}ã€"
            echo "â„¹ï¸ å»ºè®®ï¼š1. ç¡®è®¤åˆ†æ”¯åæ‹¼å†™ï¼›2. æ£€æŸ¥åˆ†æ”¯æ˜¯å¦å·²æ¨è¿œç«¯"
            exit 1
          fi
          echo "âœ… è¿œç«¯ç›®æ ‡åˆ†æ”¯ã€Œorigin/${WORK_BRANCH}ã€å­˜åœ¨"

          # å¤„ç†æœ¬åœ°åˆ†æ”¯ï¼ˆå­˜åœ¨åˆ™åŒæ­¥ï¼Œä¸å­˜åœ¨åˆ™åˆ›å»ºï¼‰
          if git show-ref --verify --quiet "refs/heads/${WORK_BRANCH}"; then
            git checkout "${WORK_BRANCH}"
            echo "â„¹ï¸ æœ¬åœ°å·²å­˜åœ¨åˆ†æ”¯ï¼ŒåŒæ­¥è¿œç«¯æ›´æ–°ï¼ˆå¿«é€Ÿåˆå¹¶ï¼‰"
            git merge --ff-only "origin/${WORK_BRANCH}" || { echo -e "\n::error::âŒ å¿«é€Ÿåˆå¹¶å¤±è´¥ï¼Œå­˜åœ¨æœ¬åœ°æœªæ¨é€ä¿®æ”¹"; exit 1; }
            echo "âœ… æœ¬åœ°åˆ†æ”¯åŒæ­¥è¿œç«¯æ›´æ–°å®Œæˆ"
          else
            git checkout -B "${WORK_BRANCH}" "origin/${WORK_BRANCH}"
            echo "âœ… æœ¬åœ°åˆ›å»ºåˆ†æ”¯ã€Œ${WORK_BRANCH}ã€ï¼ŒåŸºäºè¿œç«¯åˆ†æ”¯"
          fi

      # æ­¥éª¤4ï¼šå­æ¨¡å—é…ç½®ä¸æ›´æ–°ï¼ˆç‹¬ç«‹æµç¨‹ï¼Œä¸å½±å“åç»­æ–‡ä»¶æ›¿æ¢ï¼‰
      - name: Configure and update submodule
        id: sm_update
        run: |
          set -euo pipefail
          SM_NAME="libs/hbb_common"
          SM_URL="${{ inputs.submodule_url }}"
          REQ_BRANCH="${{ inputs.submodule_branch }}"

          echo -e "\n=================================================="
          echo -e "ğŸ”— å­æ¨¡å—é…ç½®ä¸æ›´æ–°ï¼ˆç›®æ ‡ï¼š${SM_PATH}ï¼‰"
          echo -e "ğŸ“Œ ä»“åº“ï¼š${SM_URL} | è¾“å…¥åˆ†æ”¯ï¼š${REQ_BRANCH}"
          echo -e "==================================================\n"

          # æ ¡éªŒ.gitmodulesæ–‡ä»¶
          if [ ! -f ".gitmodules" ]; then
            echo -e "\n::error::âŒ ç¼ºå¤±.gitmodulesæ–‡ä»¶ï¼Œæ— å­æ¨¡å—é…ç½®"
            exit 1
          fi
          echo "âœ… æ£€æµ‹åˆ°.gitmodulesæ–‡ä»¶"

          # å¤„ç†å­æ¨¡å—åˆ†æ”¯ï¼ˆè‡ªåŠ¨æ£€æµ‹/æŒ‡å®šåˆ†æ”¯ï¼‰
          DETECTED_BRANCH="${REQ_BRANCH}"
          if [ "${REQ_BRANCH}" = "auto" ] || ! git ls-remote --heads "${SM_URL}" "${REQ_BRANCH}" | grep -q "."; then
            echo "ğŸ” è‡ªåŠ¨æ£€æµ‹å­æ¨¡å—é»˜è®¤åˆ†æ”¯..."
            DETECTED_BRANCH=$(git ls-remote --symref "${SM_URL}" HEAD | awk '/^ref:/ {print $2}' | sed 's#refs/heads/##')
            if [ -z "${DETECTED_BRANCH}" ]; then
              echo -e "\n::error::âŒ è‡ªåŠ¨æ£€æµ‹å­æ¨¡å—åˆ†æ”¯å¤±è´¥ï¼Œæ‰‹åŠ¨æŒ‡å®šsubmodule_branch"
              exit 1
            fi
            echo "âœ… è‡ªåŠ¨æ£€æµ‹å­æ¨¡å—åˆ†æ”¯ï¼š${DETECTED_BRANCH}"
          else
            echo "âœ… å­æ¨¡å—è¿œç«¯å­˜åœ¨æŒ‡å®šåˆ†æ”¯ï¼š${REQ_BRANCH}"
          fi
          echo "sm_branch=${DETECTED_BRANCH}" >> "$GITHUB_OUTPUT"

          # é…ç½®.gitmoduleså¹¶æäº¤ï¼ˆæœ‰å˜æ›´æ‰æäº¤ï¼‰
          git config -f .gitmodules "submodule.${SM_NAME}.url" "${SM_URL}"
          git config -f .gitmodules "submodule.${SM_NAME}.path" "${SM_PATH}"
          git config -f .gitmodules "submodule.${SM_NAME}.branch" "${DETECTED_BRANCH}"
          git add .gitmodules

          if ! git diff --cached --quiet; then
            git commit -m "chore(submodule): config ${SM_PATH} to ${SM_URL} (branch: ${DETECTED_BRANCH})"
            echo "âœ… æäº¤.gitmodulesé…ç½®ä¿®æ”¹"
          else
            echo "â„¹ï¸ .gitmodulesé…ç½®æ— å˜æ›´ï¼Œæ— éœ€æäº¤"
          fi

          # åŒæ­¥å­æ¨¡å—å†…å®¹
          echo -e "\nğŸš€ åŒæ­¥å­æ¨¡å—é…ç½®ä¸å†…å®¹..."
          git submodule sync -- "${SM_PATH}"
          git submodule set-url "${SM_PATH}" "${SM_URL}" || true
          git submodule set-branch --branch "${DETECTED_BRANCH}" "${SM_PATH}" || true
          git submodule update --init --remote "${SM_PATH}" || { echo -e "\n::error::âŒ å­æ¨¡å—æ›´æ–°å¤±è´¥ï¼Œæ£€æŸ¥URL/ç½‘ç»œ"; exit 1; }
          echo "âœ… å­æ¨¡å—å†…å®¹åŒæ­¥å®Œæˆ"

          # å­æ¨¡å—åˆ‡æ¢åˆ†æ”¯å¹¶æäº¤æŒ‡é’ˆï¼ˆé¿å…detached HEADï¼‰
          git -C "${SM_PATH}" fetch origin --no-tags
          if ! git -C "${SM_PATH}" rev-parse --verify -q "origin/${DETECTED_BRANCH}" >/dev/null; then
            echo -e "\n::error::âŒ å­æ¨¡å—è¿œç«¯æ— åˆ†æ”¯ã€Œorigin/${DETECTED_BRANCH}ã€"
            exit 1
          fi
          git -C "${SM_PATH}" checkout -B "${DETECTED_BRANCH}" "origin/${DETECTED_BRANCH}"
          git add "${SM_PATH}"

          if ! git diff --cached --quiet; then
            git commit -m "chore(submodule): bump ${SM_PATH} to origin/${DETECTED_BRANCH} (latest)"
            echo "âœ… æäº¤å­æ¨¡å—æŒ‡é’ˆæ›´æ–°"
          else
            echo "â„¹ï¸ å­æ¨¡å—å·²ä¸ºæœ€æ–°ç‰ˆæœ¬ï¼Œæ— éœ€æäº¤"
          fi

      # æ­¥éª¤5ï¼šadmin URLæ›¿æ¢ï¼ˆæ–°å¢è·³è¿‡/å¼ºåˆ¶é€»è¾‘ï¼Œç‹¬ç«‹æ­¥éª¤ä¸é˜»å¡åç»­ï¼‰
      - name: Replace admin HTTPS URL (with skip/force strategy)
        run: |
          set -euo pipefail
          NEW_URL="${{ inputs.admin_url }}"
          REPLACE_STRATEGY="${{ inputs.url_replace_strategy }}"
          replace_file_count=0
          force_triggered=false

          echo -e "\n=================================================="
          echo -e "ğŸ”„ admin URLæ›¿æ¢ï¼ˆç­–ç•¥ï¼š${REPLACE_STRATEGY} | æ’é™¤å­æ¨¡å—ï¼š${SM_PATH}ï¼‰"
          echo -e "ğŸ“Œ æ—§URLï¼š${TARGET_OLD_URL} | æ–°URLï¼š***ï¼ˆéšç§éšè—ï¼‰"
          echo -e "==================================================\n"

          # 1. æ£€æµ‹éœ€æ›¿æ¢æ–‡ä»¶
          echo "ğŸ” æ£€æµ‹å«æ—§URLçš„æ–‡ä»¶..."
          files_http=$(git grep -l -E "${TARGET_OLD_URL}" -- "${URL_REPLACE_EXCLUDE}" || true)
          if [ -n "${files_http}" ]; then
            replace_file_count=$(echo "${files_http}" | wc -w)
            echo "âœ… æ£€æµ‹åˆ° ${replace_file_count} ä¸ªæ–‡ä»¶éœ€æ›¿æ¢ï¼š"
            echo "${files_http}" | tr ' ' '\n' | awk '{print "   - " $0}'
          else
            echo "â„¹ï¸ æœªæ£€æµ‹åˆ°å«æ—§URLçš„æ–‡ä»¶"
            # å¤„ç†â€œæ— éœ€ä¿®æ”¹â€åœºæ™¯ï¼šæŒ‰ç­–ç•¥å†³å®šè·³è¿‡/å¼ºåˆ¶
            if [ "${REPLACE_STRATEGY}" = "skip" ]; then
              echo "âœ… ç­–ç•¥ä¸ºã€Œskipã€ï¼Œè·³è¿‡URLæ›¿æ¢æ­¥éª¤"
              return 0  # æ­£å¸¸è·³è¿‡ï¼Œä¸å½±å“åç»­æ­¥éª¤
            else
              echo "âš ï¸ ç­–ç•¥ä¸ºã€Œforceã€ï¼Œå¼ºåˆ¶æ‰§è¡Œæ›¿æ¢ï¼ˆå³ä½¿æ— åŒ¹é…æ–‡ä»¶ï¼‰"
              force_triggered=true
            fi
          fi

          # 2. æ‰§è¡Œæ›¿æ¢ï¼ˆå«å¼ºåˆ¶æ›¿æ¢é€»è¾‘ï¼‰
          echo -e "\nğŸš€ å¼€å§‹æ‰§è¡ŒURLæ›¿æ¢..."
          new_esc="${NEW_URL//&/\\&}"  # è½¬ä¹‰ç‰¹æ®Šå­—ç¬¦ï¼Œé¿å…sedæŠ¥é”™
          if [ -n "${files_http}" ]; then
            echo "${files_http}" | xargs -r sed -i -e "s|${TARGET_OLD_URL}|${new_esc}|g"
          elif [ "${force_triggered}" = "true" ]; then
            # å¼ºåˆ¶æ›¿æ¢ï¼šéå†æ ¸å¿ƒç›®å½•ï¼ˆé¿å…å…¨é‡æ‰«æï¼‰ï¼Œç¡®ä¿å†…å®¹ä¸€è‡´
            core_dirs=("src" "flutter/lib" "config")
            for dir in "${core_dirs[@]}"; do
              if [ -d "${dir}" ]; then
                find "${dir}" -type f -not -path "*/${SM_PATH}/*" -exec sed -i -e "s|${TARGET_OLD_URL}|${new_esc}|g" {} \; 2>/dev/null
              fi
            done
            echo "âœ… å¼ºåˆ¶æ›¿æ¢å®Œæˆï¼ˆéå†æ ¸å¿ƒç›®å½•ï¼Œç¡®ä¿æ— æ—§URLæ®‹ç•™ï¼‰"
          fi

          # 3. æ ¡éªŒæ›¿æ¢ç»“æœ
          echo -e "\nğŸ” æ›¿æ¢åæ®‹ç•™æ£€æµ‹..."
          residual=$(git grep -n -E "${TARGET_OLD_URL}" -- "${URL_REPLACE_EXCLUDE}" || true)
          if [ -z "${residual}" ]; then
            echo "âœ… æ— æ—§URLæ®‹ç•™ï¼Œæ›¿æ¢ç»“æœç¬¦åˆé¢„æœŸ"
          else
            echo "âš ï¸ æ£€æµ‹åˆ°æ—§URLæ®‹ç•™ï¼ˆå‰10è¡Œï¼‰ï¼š"
            echo "${residual}" | head -n 10 | awk '{print "   " $0}'
            # å¼ºåˆ¶æ›¿æ¢åœºæ™¯ä¸‹ï¼Œæ®‹ç•™ä¸ç»ˆæ­¢æµç¨‹ï¼›æ­£å¸¸åœºæ™¯ä¸‹æŠ¥è­¦å‘Š
            if [ "${REPLACE_STRATEGY}" != "force" ]; then
              echo -e "\n::warning::âš ï¸ æ­£å¸¸æ›¿æ¢åä»æœ‰æ®‹ç•™ï¼Œå»ºè®®æ‰‹åŠ¨æ£€æŸ¥"
            fi
          fi

          # 4. æäº¤ä¿®æ”¹ï¼ˆåŒºåˆ†æ­£å¸¸/å¼ºåˆ¶åœºæ™¯çš„commitä¿¡æ¯ï¼‰
          if ! git diff --quiet; then
            commit_msg="chore(url): update admin HTTPS URL (total ${replace_file_count} files, strategy: ${REPLACE_STRATEGY})"
            [ "${force_triggered}" = "true" ] && commit_msg="${commit_msg} [force triggered]"
            git add -A
            git commit -m "${commit_msg}"
            echo "ğŸ“ æäº¤å®Œæˆï¼Œcommitä¿¡æ¯ï¼š${commit_msg}"
          else
            echo "â„¹ï¸ æ— URLæ›¿æ¢ç›¸å…³å˜æ›´ï¼Œæ— éœ€æäº¤"
          fi

      # æ­¥éª¤6ï¼šDartæ–‡ä»¶æ›¿æ¢ï¼ˆæ–°å¢è·³è¿‡/å¼ºåˆ¶é€»è¾‘ï¼Œç‹¬ç«‹æ­¥éª¤ç¡®ä¿æ‰§è¡Œï¼‰
      - name: Replace connection_page.dart (with skip/force strategy)
        run: |
          set -euo pipefail
          TARGET_FILE="${DART_TARGET_FILE}"
          START_LINE="${DART_START_LINE}"
          END_LINE="${DART_END_LINE}"
          REPLACE_STRATEGY="${{ inputs.dart_replace_strategy }}"
          force_triggered=false

          echo -e "\n=================================================="
          echo -e "ğŸ—‘ï¸ Dartæ–‡ä»¶æ›¿æ¢ï¼ˆç­–ç•¥ï¼š${REPLACE_STRATEGY} | ç›®æ ‡æ–‡ä»¶ï¼š${TARGET_FILE}ï¼‰"
          echo -e "ğŸ“Œ ä¿®æ”¹èŒƒå›´ï¼šç¬¬ ${START_LINE} - ${END_LINE} è¡Œ | ç›®çš„ï¼šåˆ é™¤å®¢æˆ·ç«¯å¹¿å‘Šæç¤º"
          echo -e "==================================================\
